@using app.business.Services
@using app.shared.Utilities
@using Microsoft.Extensions.Localization
@inject IFeatureFlagService FeatureFlagService
@inject IDevModeService DevModeService

<header>
    <nav id="navbar" class="relative w-full z-50 bg-white shadow-sm">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <!-- Logo -->
            <a data-enhance-nav="false" href="/" class="flex items-center p-2">
                <img src="/assets/brand/logo-rounded.png" alt=".NET Cameroon Logo" class="size-12">
            </a>

            <!-- Desktop Navigation -->
            <ul id="nav-links" class="hidden md:flex items-center gap-8">
                <li>
                    <NavLink href="/" data-enhance-nav="false" Match="NavLinkMatch.All"
                        class="text-gray-700 hover:text-gray-900 transition-colors font-medium">Home</NavLink>
                </li>
                <li>
                    <DropDown Title="Events">
                        <DropDownContent>
                            <div class="py-2">
                                @if (_isNetConf2025Enabled)
                                {
                                    <NavLink href="/dotnet-conf-2025" data-enhance-nav="false"
                                        class="block px-4 py-2 text-gray-700 hover:bg-gray-100 transition-colors">.NET Conf
                                        2025</NavLink>
                                }
                                <NavLink href="/dotnet-conf-2024" data-enhance-nav="false"
                                    class="block px-4 py-2 text-gray-700 hover:bg-gray-100 transition-colors">.NET Conf
                                    2024</NavLink>
                            </div>
                        </DropDownContent>
                    </DropDown>
                </li>
                <li>
                    <NavLink href="/jobs" data-enhance-nav="false"
                        class="text-gray-700 hover:text-gray-900 transition-colors font-medium flex items-center gap-2">
                        Jobs
                        <span class="text-[10px] py-1 px-2 rounded-full bg-primary text-white">Soon</span>
                    </NavLink>
                </li>
                @* <li>
                    <NavLink href="/about" data-enhance-nav="false"
                        class="text-gray-700 hover:text-gray-900 transition-colors font-medium">About us</NavLink>
                </li>
                <li>
                    <NavLink href="/projects" data-enhance-nav="false"
                        class="text-gray-700 hover:text-gray-900 transition-colors font-medium">Projects</NavLink>
                </li>
                <li>
                    <NavLink href="/resources" data-enhance-nav="false"
                        class="text-gray-700 hover:text-gray-900 transition-colors font-medium">Resources</NavLink>
                </li> *@
            </ul>

            <!-- Right side actions -->
            <div class="flex items-center gap-4">
                <!-- Contact button -->
                <NavLink href="/contact" data-enhance-nav="false" class="btn btn-outline">
                    Contact-us
                </NavLink>

                <!-- Language selector -->
                <div class="hidden md:flex items-center">
                    <LanguageDropdown CurrentLanguage="@GetCurrentLanguage()" GetSetCultureUrl="@GetSetCultureUrl" />
                </div>

                @if (DevModeService.IsDevMode)
                {
                    <span class="bg-primary text-white px-2 py-1 rounded text-sm">Dev mode</span>
                }

                <!-- Mobile hamburger menu -->
                <button id="hamburger" onclick="toggleNavbar()" title="Hamburger menu" aria-label="Hamburger menu"
                    class="md:hidden">
                    <span></span>
                </button>
            </div>
        </div>

        <!-- Mobile Navigation -->
        <div id="mobile-nav" class="md:hidden bg-white border-t border-gray-200 hidden">
            <div class="px-4 py-4 space-y-4">
                <NavLink href="/" data-enhance-nav="false"
                    class="block text-gray-700 hover:text-gray-900 transition-colors font-medium">Home</NavLink>
                <div class="space-y-2">
                    <div class="text-gray-700 font-medium">Events</div>
                    @if (_isNetConf2025Enabled)
                    {
                        <NavLink href="/dotnet-conf-2025" data-enhance-nav="false"
                            class="block pl-4 text-gray-600 hover:text-gray-900 transition-colors">.NET Conf 2025</NavLink>
                    }
                    <NavLink href="/dotnet-conf-2024" data-enhance-nav="false"
                        class="block pl-4 text-gray-600 hover:text-gray-900 transition-colors">.NET Conf 2024</NavLink>
                </div>
                <NavLink href="/jobs" data-enhance-nav="false"
                    class="block text-gray-700 hover:text-gray-900 transition-colors font-medium flex items-center gap-2">
                    Jobs
                    <span class="text-[10px] py-1 px-2 rounded-full bg-primary text-white">Soon</span>
                </NavLink>
                @* <NavLink href="/about" data-enhance-nav="false"
                    class="block text-gray-700 hover:text-gray-900 transition-colors font-medium">About us</NavLink>
                <NavLink href="/projects" data-enhance-nav="false"
                    class="block text-gray-700 hover:text-gray-900 transition-colors font-medium">Projects</NavLink>
                <NavLink href="/resources" data-enhance-nav="false"
                    class="block text-gray-700 hover:text-gray-900 transition-colors font-medium">Resources</NavLink>
                <NavLink href="/contact" data-enhance-nav="false"
                    class="block text-gray-700 hover:text-gray-900 transition-colors font-medium">Contact-us</NavLink> *@
                <div class="flex items-center gap-4 pt-4 border-t border-gray-200">
                    <LanguageDropdown CurrentLanguage="@GetCurrentLanguage()" GetSetCultureUrl="@GetSetCultureUrl" />
                </div>
            </div>
        </div>
    </nav>
</header>

@code {
    [Parameter]
    public NavType Type { get; set; }

    private string NavBarClass => Type == NavType.Default ? string.Empty : "transparent";

    [Inject]
    private NavigationManager NavigationManager { get; set; } = null!;

    [Inject]
    private IStringLocalizerFactory LocalizerFactory { get; set; } = null!;

    private IStringLocalizer? _sharedLocalizer;
    private IStringLocalizer SharedLocalizer => _sharedLocalizer ??= LocalizerFactory.Create("SharedResources", "app");
    private bool _isNetConf2025Enabled;

    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();
        _isNetConf2025Enabled = await FeatureFlagService.IsEnabledAsync(Features.NetConf2025);
    }

    private string GetSetCultureUrl(string culture)
    {
        // Use current page path as return URL so user stays on the same page after language switch
        var currentPath = NavigationManager.ToBaseRelativePath(NavigationManager.Uri);
        var returnUrl = string.IsNullOrEmpty(currentPath) ? "/" : $"/{currentPath}";
        return $"/setculture?culture={culture}&returnUrl={Uri.EscapeDataString(returnUrl)}";
    }

    private string GetCurrentLanguage()
    {
        var culture = System.Globalization.CultureInfo.CurrentCulture.Name;
        return culture switch
        {
            "fr-FR" => "FranÃ§ais",
            _ => "English"
        };
    }
}