@page "/jobs"
@using Microsoft.Extensions.Localization
@attribute [StreamRendering]
@inject Microsoft.Extensions.Localization.IStringLocalizerFactory LocalizerFactory
@inject NavigationManager NavigationManager

<PageTitle>Jobs - .NET Cameroon</PageTitle>
<HeadContent>
    <meta name="description" content="Find .NET and software development job opportunities in Cameroon and beyond. Connect with companies looking for talented .NET developers.">
    <meta property="og:title" content="Jobs - .NET Cameroon">
    <meta property="og:description" content="Find .NET and software development job opportunities in Cameroon and beyond.">
    <meta property="og:image" content="https://dotnet.cm/assets/brand/logo.png">
    <meta property="og:url" content="https://dotnet.cm/jobs">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Jobs - .NET Cameroon">
    <meta name="twitter:description" content="Find .NET and software development job opportunities in Cameroon and beyond.">
</HeadContent>

<div>
    <NavBar />
    
    <!-- Hero Section -->
    <section class="relative bg-gradient-to-br from-primary to-secondary py-20">
        <div class="container mx-auto px-4 py-16">
            <div class="text-center text-white">
                <h1 class="heading heading-1 text-white mb-4">Find Your Next Opportunity</h1>
                <p class="text-xl md:text-2xl mb-8 max-w-3xl mx-auto">
                    Discover .NET and software development jobs in Cameroon and worldwide
                </p>
                <a href="/jobs/submit" data-enhance-nav="false" class="btn btn-outline-white">
                    <i class="fa-solid fa-plus"></i> Post a Job
                </a>
            </div>
        </div>
    </section>

    <!-- Search and Filter Section -->
    <section class="bg-white shadow-md -mt-8 relative z-10">
        <div class="container mx-auto px-4 py-6">
            <div class="flex flex-col md:flex-row gap-4">
                <div class="flex-1">
                    <input type="text" 
                           @bind="_searchQuery"
                           @bind:event="oninput"
                           placeholder="Search jobs by title, skills, or company..." 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                </div>
                <div class="flex flex-col md:flex-row gap-4">
                    <select @bind="_selectedLocation" class="px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                        <option value="">All Locations</option>
                        <option value="douala">Douala</option>
                        <option value="yaounde">Yaoundé</option>
                        <option value="remote">Remote</option>
                        <option value="international">International</option>
                    </select>
                    <select @bind="_selectedType" class="px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                        <option value="">All Types</option>
                        <option value="full-time">Full-time</option>
                        <option value="part-time">Part-time</option>
                        <option value="contract">Contract</option>
                        <option value="freelance">Freelance</option>
                        <option value="internship">Internship</option>
                    </select>
                    <button @onclick="ApplyFilters" class="btn btn-primary whitespace-nowrap">
                        <i class="fa-solid fa-search"></i> Search
                    </button>
                </div>
            </div>
            
            @if (!string.IsNullOrEmpty(_searchQuery) || !string.IsNullOrEmpty(_selectedLocation) || !string.IsNullOrEmpty(_selectedType))
            {
                <div class="mt-4 flex items-center gap-2">
                    <span class="text-sm text-gray-600">Active filters:</span>
                    @if (!string.IsNullOrEmpty(_searchQuery))
                    {
                        <span class="px-3 py-1 bg-primary text-white rounded-full text-xs flex items-center gap-2">
                            "@_searchQuery"
                            <button @onclick="() => ClearFilter(nameof(_searchQuery))" class="hover:bg-white hover:text-primary rounded-full">
                                <i class="fa-solid fa-times"></i>
                            </button>
                        </span>
                    }
                    @if (!string.IsNullOrEmpty(_selectedLocation))
                    {
                        <span class="px-3 py-1 bg-primary text-white rounded-full text-xs flex items-center gap-2">
                            @_selectedLocation
                            <button @onclick="() => ClearFilter(nameof(_selectedLocation))" class="hover:bg-white hover:text-primary rounded-full">
                                <i class="fa-solid fa-times"></i>
                            </button>
                        </span>
                    }
                    @if (!string.IsNullOrEmpty(_selectedType))
                    {
                        <span class="px-3 py-1 bg-primary text-white rounded-full text-xs flex items-center gap-2">
                            @_selectedType
                            <button @onclick="() => ClearFilter(nameof(_selectedType))" class="hover:bg-white hover:text-primary rounded-full">
                                <i class="fa-solid fa-times"></i>
                            </button>
                        </span>
                    }
                    <button @onclick="ClearAllFilters" class="text-sm text-primary hover:underline ml-2">
                        Clear all
                    </button>
                </div>
            }
        </div>
    </section>

    <!-- Job Listings Section -->
    <section class="section container mx-auto px-4">
        <div class="mb-8 flex justify-between items-center">
            <div>
                <h2 class="heading heading-2 mb-2">Latest Job Opportunities</h2>
                <p class="text-gray-600">@FilteredJobs.Length position@(FilteredJobs.Length != 1 ? "s" : "") found</p>
            </div>
            <div class="flex gap-2">
                <button @onclick="() => _viewMode = ViewMode.Grid" 
                        class="p-2 @(_viewMode == ViewMode.Grid ? "text-primary" : "text-gray-400") hover:text-primary">
                    <i class="fa-solid fa-th-large"></i>
                </button>
                <button @onclick="() => _viewMode = ViewMode.List" 
                        class="p-2 @(_viewMode == ViewMode.List ? "text-primary" : "text-gray-400") hover:text-primary">
                    <i class="fa-solid fa-list"></i>
                </button>
            </div>
        </div>

        @if (FilteredJobs.Length == 0)
        {
            <!-- Coming Soon Message -->
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-8 text-center">
                <div class="max-w-2xl mx-auto">
                    <i class="fa-solid fa-briefcase text-6xl text-primary mb-4"></i>
                    <h3 class="heading heading-3 mb-4">Job Board Coming Soon</h3>
                    <p class="text-gray-700 mb-6">
                        We're currently building our job board to connect talented .NET developers with amazing opportunities. 
                        In the meantime, join our community to stay updated on job openings shared by our members.
                    </p>
                    <div class="flex flex-wrap gap-4 justify-center">
                        <a href="https://discord.gg/npkCMRgqdm" target="_blank" class="btn btn-primary">
                            <i class="fa-brands fa-discord"></i> Join Discord
                        </a>
                        <a href="https://www.linkedin.com/company/dotnetcameroon" target="_blank" class="btn btn-secondary">
                            <i class="fa-brands fa-linkedin"></i> Follow on LinkedIn
                        </a>
                    </div>
                </div>
            </div>
        }
        else
        {
            <!-- Job Cards -->
            <div class="@(_viewMode == ViewMode.Grid ? "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3" : "flex flex-col") gap-6">
                @foreach (var job in FilteredJobs)
                {
                    <div class="bg-white border border-gray-200 rounded-lg p-6 hover:shadow-lg transition-all">
                        <div class="flex items-start justify-between mb-4">
                            <div class="flex-1">
                                <h4 class="font-bold text-lg mb-1">@job.Title</h4>
                                <p class="text-gray-600 text-sm mb-2">@job.Company</p>
                            </div>
                            <span class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-xs whitespace-nowrap ml-2">@job.Type</span>
                        </div>
                        <div class="flex flex-wrap items-center gap-4 text-sm text-gray-600 mb-4">
                            <span><i class="fa-solid fa-location-dot"></i> @job.Location</span>
                            <span><i class="fa-solid fa-clock"></i> @job.PostedDate</span>
                            @if (!string.IsNullOrEmpty(job.Salary))
                            {
                                <span><i class="fa-solid fa-money-bill"></i> @job.Salary</span>
                            }
                        </div>
                        <div class="flex flex-wrap gap-2 mb-4">
                            @foreach (var skill in job.Skills)
                            {
                                <span class="px-2 py-1 bg-blue-100 text-primary text-xs rounded">@skill</span>
                            }
                        </div>
                        <p class="text-gray-700 text-sm mb-4 line-clamp-2">@job.Description</p>
                        <a href="/jobs/@job.Id" data-enhance-nav="false" class="btn btn-outline w-full">
                            View Details
                        </a>
                    </div>
                }
            </div>
        }

        <!-- Sample Job Cards (for demonstration) -->
        @if (_exampleJobs.Length > 0)
        {
            <div class="mt-12">
                <h3 class="heading heading-3 mb-6">How It Will Work</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    @foreach (var example in _exampleJobs)
                    {
                        <div class="bg-white border border-gray-200 rounded-lg p-6 hover:shadow-lg transition-all opacity-50">
                            <div class="flex items-start justify-between mb-4">
                                <div>
                                    <h4 class="font-bold text-lg mb-1">@example.Title</h4>
                                    <p class="text-gray-600 text-sm">@example.Company</p>
                                </div>
                                <span class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-xs">@example.Type</span>
                            </div>
                            <div class="flex items-center gap-4 text-sm text-gray-600 mb-4">
                                <span><i class="fa-solid fa-location-dot"></i> @example.Location</span>
                                <span><i class="fa-solid fa-clock"></i> @example.PostedDate</span>
                            </div>
                            <div class="flex flex-wrap gap-2 mb-4">
                                @foreach (var skill in example.Skills)
                                {
                                    <span class="px-2 py-1 bg-blue-100 text-primary text-xs rounded">@skill</span>
                                }
                            </div>
                            <p class="text-gray-700 text-sm mb-4 line-clamp-2">@example.Description</p>
                            <button class="btn btn-outline w-full" disabled>View Details</button>
                        </div>
                    }
                </div>
            </div>
        }
    </section>

    <!-- Call to Action Section -->
    <section class="bg-gray-50 py-16">
        <div class="container mx-auto px-4 text-center">
            <h2 class="heading heading-2 mb-4">Are You Hiring?</h2>
            <p class="text-gray-700 mb-8 max-w-2xl mx-auto">
                If you're looking to hire talented .NET developers, reach out to us. 
                We can help you connect with skilled professionals from our community.
            </p>
            <div class="flex flex-wrap gap-4 justify-center">
                <a href="/jobs/submit" data-enhance-nav="false" class="btn btn-primary">
                    <i class="fa-solid fa-plus"></i> Post a Job
                </a>
                <a href="/contact" data-enhance-nav="false" class="btn btn-secondary">
                    <i class="fa-solid fa-envelope"></i> Contact Us
                </a>
            </div>
        </div>
    </section>
</div>

@code {
    private IStringLocalizer? _sharedLocalizer;
    private IStringLocalizer SharedLocalizer => _sharedLocalizer ??= LocalizerFactory.Create("SharedResources", "app");

    private string _searchQuery = "";
    private string _selectedLocation = "";
    private string _selectedType = "";
    private ViewMode _viewMode = ViewMode.Grid;

    private enum ViewMode
    {
        Grid,
        List
    }

    private class JobExample
    {
        public string Id { get; set; } = Guid.NewGuid().ToString();
        public string Title { get; set; } = "";
        public string Company { get; set; } = "";
        public string Type { get; set; } = "";
        public string Location { get; set; } = "";
        public string PostedDate { get; set; } = "";
        public string[] Skills { get; set; } = [];
        public string Description { get; set; } = "";
        public string Salary { get; set; } = "";
    }

    private readonly JobExample[] _exampleJobs =
    [
        new JobExample
        {
            Title = ".NET Backend Developer",
            Company = "Tech Company Ltd",
            Type = "Full-time",
            Location = "Douala",
            PostedDate = "2 days ago",
            Skills = ["C#", "ASP.NET Core", "SQL Server", "Azure"],
            Description = "We're looking for an experienced .NET developer to join our growing team and work on enterprise applications.",
            Salary = "800k - 1.2M XAF"
        },
        new JobExample
        {
            Title = "Full Stack .NET Developer",
            Company = "Startup Inc",
            Type = "Remote",
            Location = "Remote",
            PostedDate = "1 week ago",
            Skills = ["Blazor", "C#", "Entity Framework", "React"],
            Description = "Join our innovative startup and help build cutting-edge web applications using modern .NET technologies.",
            Salary = "Competitive"
        },
        new JobExample
        {
            Title = "Senior .NET Architect",
            Company = "Enterprise Solutions",
            Type = "Full-time",
            Location = "Yaoundé",
            PostedDate = "3 days ago",
            Skills = ["Azure", "Microservices", "C#", "Docker"],
            Description = "Lead the architecture and design of our cloud-native applications using .NET and Azure services.",
            Salary = "1.5M - 2M XAF"
        }
    ];

    private JobExample[] FilteredJobs => _exampleJobs
        .Where(job =>
        {
            var matchesSearch = string.IsNullOrEmpty(_searchQuery) ||
                job.Title.Contains(_searchQuery, StringComparison.OrdinalIgnoreCase) ||
                job.Company.Contains(_searchQuery, StringComparison.OrdinalIgnoreCase) ||
                job.Skills.Any(s => s.Contains(_searchQuery, StringComparison.OrdinalIgnoreCase));

            var matchesLocation = string.IsNullOrEmpty(_selectedLocation) ||
                job.Location.Equals(_selectedLocation, StringComparison.OrdinalIgnoreCase);

            var matchesType = string.IsNullOrEmpty(_selectedType) ||
                job.Type.Replace("-", "").Equals(_selectedType.Replace("-", ""), StringComparison.OrdinalIgnoreCase);

            return matchesSearch && matchesLocation && matchesType;
        })
        .ToArray();

    private void ApplyFilters()
    {
        // Filters are applied automatically via FilteredJobs property
        StateHasChanged();
    }

    private void ClearFilter(string filterName)
    {
        switch (filterName)
        {
            case nameof(_searchQuery):
                _searchQuery = "";
                break;
            case nameof(_selectedLocation):
                _selectedLocation = "";
                break;
            case nameof(_selectedType):
                _selectedType = "";
                break;
        }
        StateHasChanged();
    }

    private void ClearAllFilters()
    {
        _searchQuery = "";
        _selectedLocation = "";
        _selectedType = "";
        StateHasChanged();
    }
}
