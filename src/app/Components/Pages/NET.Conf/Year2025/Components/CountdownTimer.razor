@using Microsoft.Extensions.Localization
@inject Microsoft.Extensions.Localization.IStringLocalizerFactory LocalizerFactory

<div class="flex w-fill items-center justify-center">
    <div class="relative w-fit">
        <!-- Time Left Label -->
        <span
            class="top-0 left-0 -translate-y-[calc(100%+3px)] rotate-6 absolute bg-secondary text-white px-4 py-1 rounded-lg outline-4 outline-white text-sm font-heading">
            @SharedLocalizer["NetConf_2025_TimeLeft"]
        </span>

        <!-- Countdown Display -->
        <span class="inline-block text-4xl py-4 px-6 rounded-xl text-black bg-tertiary font-heading">
            <strong class="font-bold font-heading"><span class="font-bold font-heading" id="@CountDownId-days">0</span> @SharedLocalizer["NetConf_2025_Days"]</strong> : <span id="@CountDownId-hours">00</span> @SharedLocalizer["NetConf_2025_Hours"] : <span id="@CountDownId-seconds">00</span> @SharedLocalizer["NetConf_2025_Seconds"]
        </span>

        <!-- Event Date -->
        <span class="absolute bottom-0 left-full -translate-x-full translate-y-[calc(100%+3px)] -rotate-4 bg-primary text-white px-4 py-1 rounded-lg text-sm font-heading whitespace-nowrap outline-4 outline-white">
            @SharedLocalizer["NetConf_2025_DateLabel"] <strong class="text-white font-heading font-bold">@EventDateFormatted</strong>
        </span>
    </div>
</div>

<script defer>
    function startCountdownTimer(eventDate) {
        const daysElement = document.getElementById("@CountDownId-days");
        const hoursElement = document.getElementById("@CountDownId-hours");
        const secondsElement = document.getElementById("@CountDownId-seconds");

        function updateCountdown() {
            const now = new Date();
            const targetDate = new Date(eventDate);
            const timeRemaining = targetDate.getTime() - now.getTime();

            if (timeRemaining > 0) {
                const days = Math.floor(timeRemaining / (1000 * 60 * 60 * 24));
                const hours = Math.floor((timeRemaining % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((timeRemaining % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((timeRemaining % (1000 * 60)) / 1000);

                daysElement.innerText = days;
                hoursElement.innerText = hours.toString().padStart(2, "0");
                secondsElement.innerText = seconds.toString().padStart(2, "0");
            } else {
                daysElement.innerText = "0";
                hoursElement.innerText = "00";
                secondsElement.innerText = "00";
                clearInterval(interval);
            }
        }

        const interval = setInterval(updateCountdown, 1000);
        updateCountdown();
    }

    const eventDate = `@DueDate.ToString("O")`;
    startCountdownTimer(eventDate);
</script>

@code {
    [Parameter]
    public DateTime DueDate { get; set; } = new DateTime(2025, 12, 20, 0, 0, 0, DateTimeKind.Utc);

    private string CountDownId { get; set; } = Guid.NewGuid().ToString("N");

    private IStringLocalizer? _sharedLocalizer;
    private IStringLocalizer SharedLocalizer => _sharedLocalizer ??= LocalizerFactory.Create("SharedResources", "app");

    private string EventDateFormatted => DueDate.ToString("MMMM dd, yyyy", System.Globalization.CultureInfo.CurrentCulture);
}
